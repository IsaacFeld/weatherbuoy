function formatDay(dateString) {
  const day = Number(dateString.split("-")[2]);
  const suffix = (day % 10 === 1 && day !== 11) ? "st" :
                 (day % 10 === 2 && day !== 12) ? "nd" :
                 (day % 10 === 3 && day !== 13) ? "rd" : "th";
  return day + suffix;
}

const ctx = document.getElementById("temperature-chart");
 const labels = ["2025-11-01 00:00:00", "2025-11-01 01:00:00",
"2025-11-01 02:00:00", "2025-11-01 03:00:00", "2025-11-01 04:00:00",
"2025-11-01 05:00:00", "2025-11-01 06:00:00", "2025-11-01 07:00:00",
"2025-11-01 08:00:00", "2025-11-01 09:00:00", "2025-11-01 10:00:00",
"2025-11-01 11:00:00", "2025-11-01 12:00:00", "2025-11-01 13:00:00",
"2025-11-01 14:00:00", "2025-11-01 15:00:00", "2025-11-01 16:00:00",
"2025-11-01 17:00:00", "2025-11-01 18:00:00", "2025-11-01 19:00:00",
"2025-11-01 20:00:00", "2025-11-01 21:00:00", "2025-11-01 22:00:00",
"2025-11-01 23:00:00", "2025-11-02 00:00:00", "2025-11-02 01:00:00",
"2025-11-02 02:00:00", "2025-11-02 03:00:00", "2025-11-02 04:00:00",
"2025-11-02 05:00:00", "2025-11-02 06:00:00", "2025-11-02 07:00:00",
"2025-11-02 08:00:00", "2025-11-02 09:00:00", "2025-11-02 10:00:00",
"2025-11-02 11:00:00", "2025-11-02 12:00:00", "2025-11-02 13:00:00",
"2025-11-02 14:00:00", "2025-11-02 15:00:00", "2025-11-02 16:00:00",
"2025-11-02 17:00:00", "2025-11-02 18:00:00", "2025-11-02 19:00:00",
"2025-11-02 20:00:00", "2025-11-02 21:00:00", "2025-11-02 22:00:00",
"2025-11-02 23:00:00", "2025-11-03 00:00:00", "2025-11-03 01:00:00",
"2025-11-03 02:00:00", "2025-11-03 03:00:00", "2025-11-03 04:00:00",
"2025-11-03 05:00:00", "2025-11-03 06:00:00", "2025-11-03 07:00:00",
"2025-11-03 08:00:00", "2025-11-03 09:00:00", "2025-11-03 10:00:00",
"2025-11-03 11:00:00", "2025-11-03 12:00:00", "2025-11-03 13:00:00",
"2025-11-03 14:00:00", "2025-11-03 15:00:00", "2025-11-03 16:00:00",
"2025-11-03 17:00:00", "2025-11-03 18:00:00", "2025-11-03 19:00:00",
"2025-11-03 20:00:00", "2025-11-03 21:00:00", "2025-11-03 22:00:00",
"2025-11-03 23:00:00", "2025-11-04 00:00:00", "2025-11-04 01:00:00",
"2025-11-04 02:00:00", "2025-11-04 03:00:00", "2025-11-04 04:00:00",
"2025-11-04 05:00:00", "2025-11-04 06:00:00", "2025-11-04 07:00:00",
"2025-11-04 08:00:00", "2025-11-04 09:00:00", "2025-11-04 10:00:00",
"2025-11-04 11:00:00", "2025-11-04 12:00:00", "2025-11-04 13:00:00",
"2025-11-04 14:00:00", "2025-11-04 15:00:00", "2025-11-04 16:00:00",
"2025-11-04 17:00:00", "2025-11-04 18:00:00", "2025-11-04 19:00:00",
"2025-11-04 20:00:00", "2025-11-04 21:00:00", "2025-11-04 22:00:00",
"2025-11-04 23:00:00", "2025-11-05 00:00:00", "2025-11-05 01:00:00",
"2025-11-05 02:00:00", "2025-11-05 03:00:00", "2025-11-05 04:00:00",
"2025-11-05 05:00:00", "2025-11-05 06:00:00", "2025-11-05 07:00:00",
"2025-11-05 08:00:00", "2025-11-05 09:00:00", "2025-11-05 10:00:00",
"2025-11-05 11:00:00", "2025-11-05 12:00:00", "2025-11-05 13:00:00",
"2025-11-05 14:00:00", "2025-11-05 15:00:00", "2025-11-05 16:00:00",
"2025-11-05 17:00:00", "2025-11-05 18:00:00", "2025-11-05 19:00:00",
"2025-11-05 20:00:00", "2025-11-05 21:00:00", "2025-11-05 22:00:00",
"2025-11-05 23:00:00", "2025-11-06 00:00:00", "2025-11-06 01:00:00",
"2025-11-06 02:00:00", "2025-11-06 03:00:00", "2025-11-06 04:00:00",
"2025-11-06 05:00:00", "2025-11-06 06:00:00", "2025-11-06 07:00:00",
"2025-11-06 08:00:00", "2025-11-06 09:00:00", "2025-11-06 10:00:00",
"2025-11-06 11:00:00", "2025-11-06 12:00:00", "2025-11-06 13:00:00",
"2025-11-06 14:00:00", "2025-11-06 15:00:00", "2025-11-06 16:00:00",
"2025-11-06 17:00:00", "2025-11-06 18:00:00", "2025-11-06 19:00:00",
"2025-11-06 20:00:00", "2025-11-06 21:00:00", "2025-11-06 22:00:00",
"2025-11-06 23:00:00", "2025-11-07 00:00:00", "2025-11-07 01:00:00",
"2025-11-07 02:00:00", "2025-11-07 03:00:00", "2025-11-07 04:00:00",
"2025-11-07 05:00:00", "2025-11-07 06:00:00", "2025-11-07 07:00:00",
"2025-11-07 08:00:00", "2025-11-07 09:00:00", "2025-11-07 10:00:00",
"2025-11-07 11:00:00", "2025-11-07 12:00:00", "2025-11-07 13:00:00",
"2025-11-07 14:00:00", "2025-11-07 15:00:00", "2025-11-07 16:00:00",
"2025-11-07 17:00:00", "2025-11-07 18:00:00", "2025-11-07 19:00:00",
"2025-11-07 20:00:00", "2025-11-07 21:00:00", "2025-11-07 22:00:00",
"2025-11-07 23:00:00", "2025-11-08 00:00:00", "2025-11-08 01:00:00",
"2025-11-08 02:00:00", "2025-11-08 03:00:00", "2025-11-08 04:00:00",
"2025-11-08 05:00:00", "2025-11-08 06:00:00", "2025-11-08 07:00:00",
"2025-11-08 08:00:00", "2025-11-08 09:00:00", "2025-11-08 10:00:00",
"2025-11-08 11:00:00", "2025-11-08 12:00:00", "2025-11-08 13:00:00",
"2025-11-08 14:00:00", "2025-11-08 15:00:00", "2025-11-08 16:00:00",
"2025-11-08 17:00:00", "2025-11-08 18:00:00", "2025-11-08 19:00:00",
"2025-11-08 20:00:00", "2025-11-08 21:00:00", "2025-11-08 22:00:00",
"2025-11-08 23:00:00", "2025-11-09 00:00:00", "2025-11-09 01:00:00",
"2025-11-09 02:00:00", "2025-11-09 03:00:00", "2025-11-09 04:00:00",
"2025-11-09 05:00:00", "2025-11-09 06:00:00", "2025-11-09 07:00:00",
"2025-11-09 08:00:00", "2025-11-09 09:00:00", "2025-11-09 10:00:00",
"2025-11-09 11:00:00", "2025-11-09 12:00:00", "2025-11-09 13:00:00",
"2025-11-09 14:00:00", "2025-11-09 15:00:00", "2025-11-09 16:00:00",
"2025-11-09 17:00:00", "2025-11-09 18:00:00", "2025-11-09 19:00:00",
"2025-11-09 20:00:00", "2025-11-09 21:00:00", "2025-11-09 22:00:00",
"2025-11-09 23:00:00", "2025-11-10 00:00:00", "2025-11-10 01:00:00",
"2025-11-10 02:00:00", "2025-11-10 03:00:00", "2025-11-10 04:00:00",
"2025-11-10 05:00:00", "2025-11-10 06:00:00", "2025-11-10 07:00:00",
"2025-11-10 08:00:00", "2025-11-10 09:00:00", "2025-11-10 10:00:00",
"2025-11-10 11:00:00", "2025-11-10 12:00:00", "2025-11-10 13:00:00",
"2025-11-10 14:00:00", "2025-11-10 15:00:00", "2025-11-10 16:00:00",
"2025-11-10 17:00:00", "2025-11-10 18:00:00", "2025-11-10 19:00:00",
"2025-11-10 20:00:00", "2025-11-10 21:00:00", "2025-11-10 22:00:00",
"2025-11-10 23:00:00", "2025-11-11 00:00:00", "2025-11-11 01:00:00",
"2025-11-11 02:00:00", "2025-11-11 03:00:00", "2025-11-11 04:00:00",
"2025-11-11 05:00:00", "2025-11-11 06:00:00", "2025-11-11 07:00:00",
"2025-11-11 08:00:00", "2025-11-11 09:00:00", "2025-11-11 10:00:00",
"2025-11-11 11:00:00", "2025-11-11 12:00:00", "2025-11-11 13:00:00",
"2025-11-11 14:00:00", "2025-11-11 15:00:00", "2025-11-11 16:00:00",
"2025-11-11 17:00:00", "2025-11-11 18:00:00", "2025-11-11 19:00:00",
"2025-11-11 20:00:00", "2025-11-11 21:00:00", "2025-11-11 22:00:00",
"2025-11-11 23:00:00", "2025-11-12 00:00:00", "2025-11-12 01:00:00",
"2025-11-12 02:00:00", "2025-11-12 03:00:00", "2025-11-12 04:00:00",
"2025-11-12 05:00:00", "2025-11-12 06:00:00", "2025-11-12 07:00:00",
"2025-11-12 08:00:00", "2025-11-12 09:00:00", "2025-11-12 10:00:00",
"2025-11-12 11:00:00", "2025-11-12 12:00:00", "2025-11-12 13:00:00",
"2025-11-12 14:00:00", "2025-11-12 15:00:00"];

const temps = [10.3, 10.21667, 10.2, 10.2, 10.19167, 10.18333,
10.1, 10.075, 10.08333, 10.14167, 10.2, 10.2375, 10.25833, 10.28333,
10.225, 10.2, 10.20833, 10.225, 10.2, 10.2, 10.21667, 10.2, 10.2,
10.28333, 10.325, 10.34167, 10.31667, 10.33333, 10.4, 10.4, 10.4, 10.4,
10.4, 10.4, 10.4, 10.4, 10.4, 10.4, 10.45, 10.5, 10.5, 10.5, 10.575,
10.5, 10.5, 10.5, 10.5, 10.5, 10.40833, 10.4, 10.4, 10.4, 10.4,
10.38333, 10.3, 10.3, 10.3, 10.3, 10.3, 10.39167, 10.4, 10.4, 10.4,
10.4, 10.4, 10.4, 10.4, 10.35833, 10.3, 10.3, 10.3, 10.3, 10.3, 10.3,
10.29167, 10.2, 10.2, 10.2, 10.2, 10.2, 10.2, 10.2, 10.33333, 10.40833,
10.54167, 10.475, 10.49167, 10.5, 10.40833, 10.4, 10.4, 10.4, 10.36667,
10.3, 10.275, 10.2, 10.2, 10.13333, 10.1, 10.1, 10.1, 10.1, 10.1, 10.1,
10.075, 10.15833, 10.25833, 10.29167, 10.4, 10.4, 10.36667, 10.3, 10.35,
10.30833, 10.3, 10.25833, 10.2, 10.2, 10.11667, 10.09167, 10.0, 10.0,
9.99167, 9.9, 9.9, 9.9, 9.88333, 9.8, 9.8, 9.93333, 10.075, 10.11667,
10.2, 10.18333, 10.1, 10.05, 10.0, 10.0, 10.0, 9.975, 9.9, 9.86667, 9.8,
9.8, 9.8, 9.76667, 9.7, 9.7, 9.63333, 9.6, 9.6, 9.6, 9.6, 9.65833, 9.8,
9.86667, 9.9, 9.95833, 9.94167, 9.825, 9.78333, 9.78333, 9.70833, 9.7,
9.6, 9.6, 9.5, 9.5, 9.5, 9.5, 9.5, 9.5, 9.46667, 9.39167, 9.4, 9.4, 9.4,
9.40833, 9.5, 9.5, 9.5, 9.5, 9.5, 9.5, 9.5, 9.5, 9.5, 9.45833, 9.4, 9.4,
9.4, 9.31667, 9.3, 9.3, 9.3, 9.24167, 9.2, 9.2, 9.2, 9.2, 9.2, 9.2,
9.25, 9.275, 9.3, 9.375, 9.36667, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3,
9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3,
9.275, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.3, 9.2, 9.2, 9.125, 9.1,
9.1, 9.1, 9.06667, 9.01667, 9.03333, 9.0, 9.0, 9.0, 9.06667, 9.1, 9.1,
9.11667, 9.2, 9.2, 9.2, 9.2, 9.2, 9.2, 9.2, 9.2, 9.2, 9.15, 9.1, 9.1,
9.00833, 9.0, 9.0, 8.90833, 8.96667, 8.9, 8.9, 8.9, 8.95833, 9.075, 9.1,
9.1, 9.1, 9.1, 9.1];

Chart.defaults.color ="#6e8cfb"
Chart.defaults.elements.point.hitRadius = 20;
Chart.defaults.plugins.legend.display = false;

const dataPoints = labels.map((label, i) => ({
  x: new Date(label),
  y: temps[i]
}));

function cssVar(name) {
  return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
}


function getSegmentColor(temp){
  if(temp > 11){
    return "#e94832"
  }
  else if(temp >= 10.6){
    return "#ed7464"
  }
  else if(temp >= 10.2){
    return "#eebd79"
  }
  else if(temp>= 9.8){
    return "#dade75"
  }
  else if(temp >= 9.4){
    return "#76c28f"
  }
  else if(temp >=9.0){
    return "#7ab2d3"
  }
  else if(temp>= 8.6){
    return "#6e8cfb"
  }
  else if(temp >= 8.2){
    return "#636ccb"
  }
}

const data = {
  labels: labels,
  datasets: [{
    label: "Schlachtensee November Temperature",
    data: dataPoints,
    fill: false,
    borderColor: "#5356ff",
    tension: 0,
    pointRadius: 0,
    segment: {
      borderColor: ctx => {getSegmentColor(ctx.p0.parsed.y)
        return getSegmentColor(ctx.p0.parsed.y)
      }
    },
  }],
};

const config = {
  type: "line",
  data: data,
  options: {
    maintainAspectRatio: window.innerWidth < 600 ? false : true,
    aspectRatio: window.innerWidth < 600 ? 0.8 : 2, // mobile = taller
    scales: {
      x: {
        type: "time",
        time: {
          unit: "day",
          tooltipFormat: "MMM dd HH:mm"
        },
        ticks: {
          color: cssVar("--chart-text"),
          callback: (_, index, ticks) => {
            const date = ticks[index].value;
            let formattedDate = formatDay(new Date(date).toISOString().split("T")[0])
            if(formattedDate == "31st"){
              return "";
            }
            return formattedDate
          }
        },
        grid: { color: cssVar("--chart-grid"),}
      },
      y: {
        ticks: {
          color: cssVar("--chart-text"),
          callback: value => `${value}â„ƒ`
        },
        grid: {
          color: cssVar("--chart-grid"),
        }
        
      }
    },
  }
}; 


const myChart =  new Chart(ctx, config);

function updateChartTheme() {
  const opts = myChart.options;

  // Update axis colors
  opts.scales.x.ticks.color = cssVar("--chart-text");
  opts.scales.y.ticks.color = cssVar("--chart-text");
  opts.scales.x.grid.color = cssVar("--chart-grid");
  opts.scales.y.grid.color = cssVar("--chart-grid");

  // Update legend
  opts.plugins.legend.labels.color = cssVar("--chart-text");

  myChart.update();
}


document.querySelector('theme-toggle').addEventListener('click', () => {
  updateChartTheme();
})